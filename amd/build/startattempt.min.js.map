{"version":3,"sources":["../src/startattempt.js"],"names":["define","$","setup","console","log","window","invigilator_share_state","document","getElementById","invigilator_window_surface","invigilator_screenoff","videoElem","logElem","displayMediaOptions","video","cursor","audio","click","event","preventDefault","startCapture","innerHTML","navigator","mediaDevices","getDisplayMedia","srcObject","css","errString","toString","alert","windowState","setInterval","updateWindowStatus","videoTrack","getVideoTracks","currentStream","active","settings","getSettings","displaySurface","value","screenoff","stop","clearInterval","location","reload","init","prop","is","hideButtons","screensharestatus","screensharemode","showButtons"],"mappings":"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","sourcesContent":["define(['jquery', 'core/ajax', 'core/notification'],\n    function($, Ajax, Notification) {\n        return {\n            setup: function(props){\n                console.log('startattempt/setup called');\n                window.invigilator_share_state = document.getElementById('invigilator_share_state');\n                window.invigilator_window_surface = document.getElementById('invigilator_window_surface');\n                window.invigilator_screenoff = document.getElementById('invigilator_screen_off_flag');\n\n                const videoElem = document.getElementById(\"invigilator-video-screen\");\n                const logElem = document.getElementById(\"invigilator-log-screen\");\n\n                var displayMediaOptions = {\n                    video: {\n                        cursor: \"always\"\n                    },\n                    audio: false\n                };\n\n                $(\"#invigilator-share-screen-btn\").click(function() {\n                    event.preventDefault();\n                    console.log('screen sharing clicked');\n                    startCapture();\n                });\n\n                async function startCapture() {\n                    logElem.innerHTML = \"\";\n                    try {\n                        // Console.log(\"vid found success\");\n                        videoElem.srcObject = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);\n                        $('#id_invigilator').css(\"display\", 'block');\n                        $(\"label[for='id_invigilator']\").css(\"display\", 'block');\n                    } catch (err) {\n                        // Console.log(\"Error: \" + err.toString());\n                        let errString = err.toString();\n                        if (errString == \"NotAllowedError: Permission denied\") {\n                            alert(\"Please share entire screen.\");\n                            return false;\n                        }\n                    }\n                }\n\n                var updateWindowStatus = function() {\n                    if (videoElem.srcObject !== null) {\n                        // Console.log(videoElem);\n                        const videoTrack = videoElem.srcObject.getVideoTracks()[0];\n                        var currentStream = videoElem.srcObject;\n                        var active = currentStream.active;\n                        var settings = videoTrack.getSettings();\n                        var displaySurface = settings.displaySurface;\n                        document.getElementById('invigilator_window_surface').value = displaySurface;\n                        document.getElementById('invigilator_share_state').value = active;\n                        var screenoff = document.getElementById('invigilator_screen_off_flag').value;\n                        if (screenoff == \"1\") {\n                            videoTrack.stop();\n                            // Console.log('video stopped');\n                            clearInterval(windowState);\n                            location.reload();\n                        }\n                    }\n                };\n                var windowState = setInterval(updateWindowStatus, 1000);\n            },\n            init: function(props) {\n                console.log('startattempt/init called');\n                $('#id_submitbutton').prop(\"disabled\", true);\n                $('#id_invigilator').css(\"display\", 'none');\n                $(\"label[for='id_invigilator']\").css(\"display\", 'none');\n\n\n                $('#id_invigilator').click(function() {\n                    if (!$(this).is(':checked')) {\n                        console.log(\"un Checked\");\n                        hideButtons();\n                    }\n                    else{\n                        console.log(\"Checked\");\n                        var screensharestatus = document.getElementById('invigilator_share_state').value;\n                        var screensharemode = document.getElementById('invigilator_window_surface').value;\n                        console.log(screensharemode);\n                        console.log(screensharestatus);\n                        if((screensharemode == 'monitor') && (screensharestatus == \"true\")){\n                            showButtons();\n                        }\n                        else{\n                            alert('Please click share screen and choose entire monitor.');\n                        }\n                    }\n                });\n\n                /**\n                 * HideButtons\n                 */\n                function hideButtons() {\n                    $('#id_submitbutton').prop(\"disabled\", true);\n                }\n\n                /**\n                 * ShowButtons\n                 */\n                function showButtons() {\n                    $('#id_submitbutton').prop(\"disabled\", false);\n                }\n                return true;\n            }\n        };\n    });\n"],"file":"startattempt.min.js"}