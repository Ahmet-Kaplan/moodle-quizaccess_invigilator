function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}f(void 0)})}}define ("quizaccess_invigilator/startattempt",["jquery","core/ajax","core/notification"],function(a){return{setup:function setup(){console.log("startattempt/setup called");window.invigilator_share_state=document.getElementById("invigilator_share_state");window.invigilator_window_surface=document.getElementById("invigilator_window_surface");window.invigilator_screenoff=document.getElementById("invigilator_screen_off_flag");var d=document.getElementById("invigilator-video-screen"),e=document.getElementById("invigilator-log-screen"),f={video:{cursor:"always"},audio:!1};a("#invigilator-share-screen-btn").click(function(){event.preventDefault();console.log("screen sharing clicked");b()});function b(){return c.apply(this,arguments)}function c(){c=_asyncToGenerator(regeneratorRuntime.mark(function b(){var c;return regeneratorRuntime.wrap(function(b){while(1){switch(b.prev=b.next){case 0:e.innerHTML="";b.prev=1;b.next=4;return navigator.mediaDevices.getDisplayMedia(f);case 4:d.srcObject=b.sent;a("#id_invigilator").css("display","block");a("label[for='id_invigilator']").css("display","block");b.next=15;break;case 9:b.prev=9;b.t0=b["catch"](1);c=b.t0.toString();if(!("NotAllowedError: Permission denied"==c)){b.next=15;break}alert("Please share entire screen.");return b.abrupt("return",!1);case 15:case"end":return b.stop();}}},b,null,[[1,9]])}));return c.apply(this,arguments)}var g=setInterval(function updateWindowStatus(){if(null!==d.srcObject){var a=d.srcObject.getVideoTracks()[0],b=d.srcObject,c=b.active,e=a.getSettings(),f=e.displaySurface;document.getElementById("invigilator_window_surface").value=f;document.getElementById("invigilator_share_state").value=c;var h=document.getElementById("invigilator_screen_off_flag").value;if("1"==h){a.stop();clearInterval(g);location.reload()}}},1e3)},init:function init(){console.log("startattempt/init called");a("#id_submitbutton").prop("disabled",!0);a("#id_invigilator").css("display","none");a("label[for='id_invigilator']").css("display","none");a("#id_invigilator").click(function(){if(!a(this).is(":checked")){console.log("un Checked");b()}else{console.log("Checked");var d=document.getElementById("invigilator_share_state").value,e=document.getElementById("invigilator_window_surface").value;console.log(e);console.log(d);if("monitor"==e&&"true"==d){c()}else{alert("Please click share screen and choose entire monitor.")}}});function b(){a("#id_submitbutton").prop("disabled",!0)}function c(){a("#id_submitbutton").prop("disabled",!1)}return!0}}});
//# sourceMappingURL=startattempt.min.js.map
