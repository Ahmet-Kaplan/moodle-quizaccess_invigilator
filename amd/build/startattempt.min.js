function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}f(void 0)})}}define ("quizaccess_invigilator/startattempt",["jquery","core/ajax","core/notification"],function(a,b,c){return{setup:function setup(d){window.invigilator_share_state=document.getElementById("invigilator_share_state");window.invigilator_window_surface=document.getElementById("invigilator_window_surface");window.invigilator_screenoff=document.getElementById("invigilator_screen_off_flag");var h=document.getElementById("invigilator-video-screen"),i=document.getElementById("invigilator-log-screen"),j={video:{cursor:"always"},audio:!1};a("#invigilator-share-screen-btn").click(function(){event.preventDefault();e()});function e(){return f.apply(this,arguments)}function f(){f=_asyncToGenerator(regeneratorRuntime.mark(function b(){var c;return regeneratorRuntime.wrap(function(b){while(1){switch(b.prev=b.next){case 0:i.innerHTML="";b.prev=1;b.next=4;return navigator.mediaDevices.getDisplayMedia(j);case 4:h.srcObject=b.sent;a("#id_invigilator").css("display","block");a("label[for='id_invigilator']").css("display","block");b.next=15;break;case 9:b.prev=9;b.t0=b["catch"](1);c=b.t0.toString();if(!("NotAllowedError: Permission denied"==c)){b.next=15;break}alert("Please share entire screen.");return b.abrupt("return",!1);case 15:case"end":return b.stop();}}},b,null,[[1,9]])}));return f.apply(this,arguments)}function g(a){var b=screen.width/screen.height;return a/b}var k=setInterval(function updateWindowStatus(){if(null!==h.srcObject){var a=h.srcObject.getVideoTracks()[0],b=h.srcObject,c=b.active,d=a.getSettings(),e=d.displaySurface;document.getElementById("invigilator_window_surface").value=e;document.getElementById("invigilator_share_state").value=c;var f=document.getElementById("invigilator_screen_off_flag").value;if("1"==f){a.stop();clearInterval(k);location.reload()}}},1e3),l=setInterval(function takeScreenshot(){var a=document.getElementById("invigilator_screen_off_flag").value;if(null!==h.srcObject){var e=h.srcObject.getVideoTracks()[0],f=h.srcObject,i=f.active,j=e.getSettings(),k=j.displaySurface;if("0"==a){if(!i){alert("Sorry !! You need to restart the attempt as you have stopped the screenshare.");clearInterval(l);window.close();return!1}if("monitor"!==k){alert("Sorry !! You need to share entire screen.");clearInterval(l);window.close();return!1}}var m=document.getElementById("invigilator-video-screen"),n=document.getElementById("invigilator-canvas-screen"),o=n.getContext("2d"),p=d.screenshotwidth,q=g(d.screenshotwidth);n.width=p;n.height=q;o.drawImage(m,0,0,p,q);var r=n.toDataURL("image/png"),s={courseid:d.courseid,cmid:d.cmid,quizid:d.quizid,screenshot:r};if("0"==a){b.call([{methodname:"quizaccess_invigilator_send_screenshot",args:s}])[0].done(function(a){if(!(1>a.warnings.length)){if(m){c.addNotification({message:"Something went wrong during taking the image.",type:"error"});clearInterval(l)}}}).fail(c.exception)}}},1e3*d.screenshotdelay)},init:function init(){a("#id_submitbutton").prop("disabled",!0);a("#id_invigilator").css("display","none");a("label[for='id_invigilator']").css("display","none");a("#id_invigilator").click(function(){if(!a(this).is(":checked")){b()}else{var d=document.getElementById("invigilator_share_state").value,e=document.getElementById("invigilator_window_surface").value;if("monitor"==e&&"true"==d){c()}else{alert("Please click share screen and choose entire monitor.")}}});function b(){a("#id_submitbutton").prop("disabled",!0)}function c(){a("#id_submitbutton").prop("disabled",!1)}return!0}}});
//# sourceMappingURL=startattempt.min.js.map
